{% load static resource_filters %}
<!-- Zen Portal Horizontal Subject Shelf - Redesigned Bento Style -->
<div id="card-{{ subject.id }}"
    class="subject-card group relative bg-white/60 dark:bg-charcoal/40 backdrop-blur-2xl border border-gray-100 dark:border-white/5 rounded-[2rem] lg:rounded-[2.5rem] shadow-xl hover:shadow-[0_20px_60px_rgba(0,0,0,0.1)] dark:hover:shadow-[0_20px_60px_rgba(0,0,0,0.4)] transition-all duration-700 overflow-hidden cursor-pointer"
    onclick="toggleSubjectCard('{{ subject.id }}')">

    <div class="flex flex-col lg:flex-row h-full">
        <!-- Left Identity Sidebar (Always Visible) -->
        <div
            class="lg:w-80 shrink-0 relative overflow-hidden p-6 lg:p-10 flex flex-col justify-between border-b lg:border-b-0 lg:border-r border-gray-100 dark:border-white/5 transition-all duration-700">
            <!-- Dynamic Gradient Background -->
            <div class="absolute inset-0 opacity-10 dark:opacity-20 transition-transform duration-1000 group-hover:scale-110
                {% if forloop.counter|divisibleby:5 %}bg-gradient-to-br from-amber-500 to-orange-600
                {% elif forloop.counter|divisibleby:4 %}bg-gradient-to-br from-violet-600 to-purple-700
                {% elif forloop.counter|divisibleby:3 %}bg-gradient-to-br from-rose-600 to-orange-700
                {% elif forloop.counter|divisibleby:2 %}bg-gradient-to-br from-emerald-600 to-teal-700
                {% else %}bg-gradient-to-br from-blue-600 to-indigo-700{% endif %}"></div>

            <div class="relative z-10">
                <!-- Course Specific Icon Container -->
                <div class="w-14 h-14 lg:w-20 lg:h-20 rounded-2xl lg:rounded-[1.75rem] mb-6 lg:mb-8 flex items-center justify-center text-3xl lg:text-4xl shadow-xl transform transition-all duration-700 group-hover:scale-110 group-hover:rotate-3
                    {% if forloop.counter|divisibleby:5 %}bg-white/95 text-amber-600 shadow-amber-500/10 dark:bg-charcoal/90 dark:text-amber-400
                    {% elif forloop.counter|divisibleby:4 %}bg-white/95 text-violet-600 shadow-violet-500/10 dark:bg-charcoal/90 dark:text-violet-400
                    {% elif forloop.counter|divisibleby:3 %}bg-white/95 text-rose-600 shadow-rose-500/10 dark:bg-charcoal/90 dark:text-rose-400
                    {% elif forloop.counter|divisibleby:2 %}bg-white/95 text-emerald-600 shadow-emerald-500/10 dark:bg-charcoal/90 dark:text-emerald-400
                    {% else %}bg-white/95 text-blue-600 shadow-blue-500/10 dark:bg-charcoal/90 dark:text-blue-400{% endif %}
                    border border-white/40 dark:border-white/10 backdrop-blur-sm">
                    <i class="{{ subject.name|subject_icon }}"></i>
                </div>

                <h3
                    class="text-2xl lg:text-3xl font-black text-charcoal dark:text-white font-['Outfit'] leading-tight mb-2 lg:mb-3">
                    {{ subject.name }}
                </h3>
                <p
                    class="text-[9px] lg:text-[10px] font-black uppercase tracking-[0.2em] lg:tracking-[0.3em] text-gray-400 dark:text-gray-500">
                    {{ subject.pdf_resources.count }} <span class="lang-en">Academic Resources</span><span
                        class="lang-ar">مصادر دراسية</span>
                </p>
            </div>

            <div class="relative z-10 mt-6 lg:mt-10">
                <div class="flex items-center justify-between mb-2 lg:mb-3">
                    <span class="text-[9px] lg:text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                        <span class="lang-en">Mastery</span><span class="lang-ar">الإتقان</span>
                    </span>
                    <span class="text-[10px] lg:text-xs font-black text-forest-green dark:text-emerald-400">0%</span>
                </div>
                <div class="h-1.5 lg:h-2 w-full bg-gray-100 dark:bg-white/5 rounded-full overflow-hidden">
                    <div
                        class="h-full bg-forest-green dark:bg-emerald-500 w-0 transition-all duration-1000 group-hover:w-[15%] rounded-full shadow-[0_0_15px_rgba(34,197,94,0.3)]">
                    </div>
                </div>
            </div>

            <!-- Expansion Hint -->
            <div
                class="absolute bottom-4 right-4 text-gray-300 dark:text-gray-600 transform transition-transform duration-700 group-[.is-open]:rotate-180 hidden lg:block">
                <i class="fas fa-chevron-right text-sm"></i>
            </div>
            <div
                class="absolute bottom-4 right-4 text-gray-300 dark:text-gray-600 transform transition-transform duration-700 group-[.is-open]:rotate-180 lg:hidden">
                <i class="fas fa-chevron-down text-sm"></i>
            </div>
        </div>

        <!-- Right Content Area: Bento Material Grid (Collapsible) -->
        <div id="content-{{ subject.id }}"
            class="subject-content flex-grow max-h-0 lg:max-h-full lg:max-w-0 overflow-hidden transition-all duration-700 opacity-0 bg-gray-50/30 dark:bg-white/5">
            <div class="p-6 lg:p-10 pb-20 lg:pb-10">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 lg:gap-6">
                    {% for category in categories %}
                    <a href="{% url 'hub:resource_detail' subject.id category %}"
                        class="group/item flex flex-col items-center justify-center p-4 lg:p-6 rounded-[1.5rem] lg:rounded-[2rem] bg-white/50 dark:bg-white/5 border border-transparent hover:border-forest-green/20 dark:hover:border-emerald-500/20 hover:bg-white dark:hover:bg-white/10 hover:shadow-2xl hover:shadow-forest-green/5 transition-all duration-500 text-center relative overflow-hidden"
                        onclick="event.stopPropagation()">

                        <div class="w-10 h-10 lg:w-14 lg:h-14 rounded-xl lg:rounded-2xl mb-3 lg:mb-4 flex items-center justify-center transition-all duration-500
                            {% if category == 'Explanation' %}bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400
                            {% elif category == 'Lectures' %}bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400
                            {% elif category == 'Sheets' %}bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400
                            {% elif category == 'Midterm' %}bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400
                            {% elif category == 'Final' %}bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400
                            {% elif category == 'Revision' %}bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400
                            {% else %}bg-gray-100 text-gray-600 dark:bg-gray-800/30 dark:text-gray-400{% endif %}
                            group-hover/item:scale-110 group-hover/item:rotate-3">
                            {% if category == 'Explanation' %}<i class="fas fa-book-open text-base lg:text-xl"></i>
                            {% elif category == 'Lectures' %}<i class="fas fa-video text-base lg:text-xl"></i>
                            {% elif category == 'Sheets' %}<i class="fas fa-file-alt text-base lg:text-xl"></i>
                            {% elif category == 'Midterm' %}<i class="fas fa-pen-fancy text-base lg:text-xl"></i>
                            {% elif category == 'Final' %}<i class="fas fa-user-graduate text-base lg:text-xl"></i>
                            {% elif category == 'Revision' %}<i class="fas fa-sync text-base lg:text-xl"></i>
                            {% else %}<i class="fas fa-folder text-base lg:text-xl"></i>
                            {% endif %}
                        </div>

                        <span
                            class="text-[10px] lg:text-xs font-black text-charcoal dark:text-white uppercase tracking-wider lg:tracking-widest transition-colors duration-300 group-hover/item:text-forest-green dark:group-hover/item:text-emerald-400">
                            {% if category == 'Lectures' %}
                            <span class="lang-en">Lectures</span><span class="lang-ar">محاضرات</span>
                            {% elif category == 'Sheets' %}
                            <span class="lang-en">Sheets</span><span class="lang-ar">شيتات</span>
                            {% elif category == 'Explanation' %}
                            <span class="lang-en">Expl.</span><span class="lang-ar">شرح</span>
                            {% elif category == 'Midterm' %}
                            <span class="lang-en">Midterm</span><span class="lang-ar">ميدتيرم</span>
                            {% elif category == 'Final' %}
                            <span class="lang-en">Final</span><span class="lang-ar">فاينل</span>
                            {% elif category == 'Revision' %}
                            <span class="lang-en">Rev.</span><span class="lang-ar">مراجعة</span>
                            {% else %}
                            {{ category }}
                            {% endif %}
                        </span>

                        <span
                            class="block text-[8px] lg:text-[10px] text-gray-500 dark:text-gray-400 font-bold mt-0.5 lg:mt-1">
                            {% if category == 'Explanation' %}
                            ({{ subject.explanation_count }})
                            {% elif category == 'Lectures' %}
                            ({{ subject.lectures_count }})
                            {% elif category == 'Sheets' %}
                            ({{ subject.sheets_count }})
                            {% elif category == 'Midterm' %}
                            ({{ subject.midterm_count }})
                            {% elif category == 'Final' %}
                            ({{ subject.final_count }})
                            {% elif category == 'Revision' %}
                            ({{ subject.revision_count }})
                            {% else %}
                            (0)
                            {% endif %}
                        </span>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Horizontal expansion only on LG screens */
    @media (min-width: 1024px) {
        .subject-content.active {
            max-width: 1500px !important;
            opacity: 1 !important;
        }
    }

    /* Vertical expansion on smaller screens */
    @media (max-width: 1023px) {
        .subject-content.active {
            max-height: 2000px !important;
            opacity: 1 !important;
        }
    }
</style>